$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
# this script is intended to be run via the run_stage() function in timit.sh.
# If using this directly, when creating the job via the CLI, use the flag --set
# to change the following:
# inputs.stage=$s                 [required] set the stage to $s
# display_name=timit-stage-$s     [optional]
# resources.instance_count=$n     [optional] set the # of parallel inst. to $n
# compute=azureml:cnn-mellin-gpu  [optional] use the gpu cluster
code: ../..
command: |
  mkdir -p data exp;
  ln -s ${{inputs.data}} data/timit;
  ln -s ${{outputs.exp}} exp/timit;
  bash ./scripts/azureml/timit_wrapper.sh -s ${{inputs.stage}} -q -x
environment: azureml:cnn-mellin@latest
compute: azureml:cnn-mellin-cpu
resources:
  instance_count: 1
distribution:
  type: pytorch
  process_count_per_instance: 1
inputs:
  stage: -1
  data:
    type: uri_folder
    mode: ro_mount
    path: azureml://datastores/workspaceblobstore/paths/data/timit
outputs:
  exp:
    type: uri_folder
    mode: rw_mount
    path: azureml://datastores/workspaceblobstore/paths/exp/timit